; File generated with Shader Minifier 1.1.4
; http://www.ctrl-alt-test.fr

_main_shader_glsl:
	db '#version 130', 10, ''
	db 'uniform int F;'
	db 'uniform sampler2D S;'
	db 'float v=F/352800.;'
	db 'vec3 i=vec3(0.,.01,1.);'
	db 'vec4 f(vec2 v)'
	db '{'
	db   'return texture2D(S,(v+.5)/textureSize(S,0));'
	db '}'
	db 'float y=6.36e+06,z=6.38e+06;'
	db 'int x=128,m=16;'
	db 'float s=.76,e=s*s,t=8000.,l=1200.,r=10.;'
	db 'vec3 w=vec3(0.,-y,0.),n=vec3(5.8e-06,1.35e-05,3.31e-05),p=vec3(2.1e-05);'
	db 'vec4 c,d;'
	db 'vec3 u;'
	db 'float g,o;'
	db 'float h(vec3 v)'
	db '{'
	db   'float i=v.y-400.,z=length(v.xz);'
	db   'v/=100.;'
	db   'vec2 y=floor(v.xz),W=y;'
	db   'float b=10.,m=10.;'
	db   'for(float C=-1.;C<=1.;C+=1.)'
	db     'for(float r=-1.;r<=1.;r+=1.)'
	db       '{'
	db         'vec2 x=y+vec2(C,r),q=x+.5,Y=floor(x/10.);'
	db         'd=f(Y);'
	db         'float e=dot(x,x);'
	db         'c=f(x);'
	db         'q+=(c.yz-.5)*smoothstep(100.,200.,e)*d.x;'
	db         'float s=abs(q.x-v.x)+abs(q.y-v.z);'
	db         'if(s<b)'
	db           'm=b,b=s,W=x;'
	db         'else'
	db           ' if(s<m)'
	db             'm=s;'
	db       '}'
	db   'float x=m-b,Y=dot(W,W);'
	db   'c=f(W);'
	db   'd=f(W/10.);'
	db   'u=v-vec3(W.x,0.,W.y);'
	db   'o=step(.8,d.w);'
	db   'float s=smoothstep(10000.,1000.,z)*(1.-o),C=s*(1.+4.*smoothstep(.8,1.,d.x));'
	db   'g=(.3-x)*.5;'
	db   'i=min(v.y,max(v.y-c.x*C,g));'
	db   'return 100.*max(i,length(v)-100.);'
	db '}'
	db 'vec3 a(vec3 v)'
	db '{'
	db   'return normalize(vec3(h(v+i.yxx),h(v+i.xyx),h(v+i.xxy))-h(v));'
	db '}'
	db 'float a(vec3 v,vec3 i,float f,float x)'
	db '{'
	db   'float y=10.,m=f;'
	db   'for(int r=0;r<199;++r)'
	db     '{'
	db       'float s=h(v+i*f);'
	db       'f+=s*.37;'
	db       'if(s<.001*f||f>x)'
	db         'return f;'
	db       'if(s<y)'
	db         'y=s,m=f;'
	db     '}'
	db   'return m;'
	db '}'
	db 'vec3 C,b,L,q;'
	db 'float Z=.5,Y=10.;'
	db 'float X(vec3 v)'
	db '{'
	db   'return mix(max(0.,dot(L,v))/3.,max(0.,pow(dot(L,normalize(v-b)),Y)*(Y+8.)/24.),Z);'
	db '}'
	db 'vec3 W=vec3(1.,.001,1.);'
	db 'float V(in vec3 v)'
	db '{'
	db   'vec3 s=floor(v),W=fract(v);'
	db   'vec2 i=s.xy+vec2(37.,17.)*s.z+W.xy,m=textureLod(S,(i+.5)/textureSize(S,0),0.).yx;'
	db   'return mix(m.x,m.y,W.z);'
	db '}'
	db 'float U(in vec3 v)'
	db '{'
	db   'return.55*V(v)+.225*V(v*2.)+.125*V(v*3.99)+.0625*V(v*8.9);'
	db '}'
	db 'float T(vec3 v)'
	db '{'
	db   'float f=U(v*.0004);'
	db   'f=smoothstep(.44,.64,f);'
	db   'f*=f*40.;'
	db   'return f;'
	db '}'
	db 'vec2 R(vec3 x)'
	db '{'
	db   'float i=max(0.,length(x-w)-y);'
	db   'vec2 m=vec2(exp(-i/t),exp(-i/l));'
	db   'float s=5000.;'
	db   'if(s<i&&i<10000.)'
	db     'm.y+=step(length(x),50000.)*T(x+vec3(23175.7,0.,v*30.))*max(0.,sin(3.1415*(i-s)/s));'
	db   'return m;'
	db '}'
	db 'float R(in vec3 v,in vec3 x,in float s)'
	db '{'
	db   'vec3 m=v-w;'
	db   'float f=dot(m,x),W=dot(m,m)-s*s,z=f*f-W;'
	db   'if(z<0.)'
	db     'return-1.;'
	db   'float i=sqrt(z),y=-f-i,b=-f+i;'
	db   'return y>=0.?y:b;'
	db '}'
	db 'vec3 T(vec3 v,vec3 i,float x)'
	db '{'
	db   'float s=x/float(m);'
	db   'vec2 f=vec2(0.);'
	db   'for(int r=0;r<m;++r)'
	db     '{'
	db       'vec3 y=v+i*float(r)*s;'
	db       'f+=R(y)*s;'
	db     '}'
	db   'return exp(-(n*f.x+p*f.y));'
	db '}'
	db 'vec3 R(vec3 v,vec3 i,float f,vec3 y)'
	db '{'
	db   'vec2 C=vec2(0.,0.);'
	db   'vec3 q=vec3(0.),b=vec3(0.);'
	db   'float c=f/float(x);'
	db   'for(int Y=0;Y<x;++Y)'
	db     '{'
	db       'vec3 g=v+i*float(Y)*c;'
	db       'vec2 d=R(g)*c;'
	db       'C+=d;'
	db       'float t=R(g,W,z);'
	db       'if(t>0.)'
	db         '{'
	db           'float V=t/float(m);'
	db           'vec2 u=vec2(0.);'
	db           'for(int w=0;w<m;++w)'
	db             '{'
	db               'vec3 Z=g+W*float(w)*V;'
	db               'u+=R(Z)*V;'
	db             '}'
	db           'vec2 Z=u+C;'
	db           'vec3 w=exp(-(n*Z.x+p*Z.y));'
	db           'q+=w*d.x;'
	db           'b+=w*d.y;'
	db         '}'
	db       'else'
	db         ' return vec3(0.);'
	db     '}'
	db   'float V=dot(i,W),Y=1.+V*V;'
	db   'vec2 d=vec2(.0596831*Y,.119366*(1.-e)*Y/((2.+e)*pow(1.+e-2.*s*V,1.5)));'
	db   'return y*exp(-(n*C.x+p*C.y))+r*(q*n*d.x+b*p*d.y);'
	db '}'
	db 'float Q(float v)'
	db '{'
	db   'return clamp(v,0.,1.);'
	db '}'
	db 'void main()'
	db '{'
	db   'vec2 s=vec2(1280.,720.),m=gl_FragCoord.xy/s*2.-1.;'
	db   'm.x*=s.x/s.y;'
	db   'v+=f(gl_FragCoord.xy+v*100.*vec2(17.,39.)).x;'
	db   'vec3 y=vec3(0.);'
	db   'C=vec3(mod(v*2.,10000.)-5000.,1000.+500.*sin(v/60.),mod(v*10.,10000.)-5000.);'
	db   'if(v<64.)'
	db     'r=10.*v/64.,y=vec3(10000.,15000.,-10000.);'
	db   'else'
	db     ' if(v<128.)'
	db       '{'
	db         'C.y=1000.;'
	db         'float x=(v-64.)/64.;'
	db         'C=vec3(x*1000.,1500.,3000.);'
	db         'y=C+vec3(-300.,0.,-300.);'
	db         'y.y=10.;'
	db         'W.y+=.01*x*x*x;'
	db       '}'
	db     'else'
	db       ' if(v<144.)'
	db         'W.y=.01;'
	db       'else'
	db         '{'
	db           'float x=(v-144.)/64.;'
	db           'C=vec3(mod(x*2.,10000.)-500.,1000.-200.*x,mod(x*10.,10000.)-5000.);'
	db           'y.y=4000.*x;'
	db           'W.y=.01+.5*x;'
	db           'r=10.+200.*max(0.,(v-196.)/16.);'
	db         '}'
	db   'W=normalize(W);'
	db   'b=normalize(C-y);'
	db   'vec3 x=normalize(cross(i.xzx,b));'
	db   'b=mat3(x,normalize(cross(b,x)),b)*normalize(vec3(m,-1.));'
	db   'vec3 e=vec3(0.);'
	db   'float w=50000.,d=a(C,b,0.,w);'
	db   'vec3 V=vec3(0.);'
	db   'if(d<w)'
	db     '{'
	db       'q=C+b*d;'
	db       'L=a(q);'
	db       'vec3 n=vec3(.3+.2*c.w)+.03*c.xyz;'
	db       'Y=200.;'
	db       'if(o>0.)'
	db         '{'
	db           'float t=step(.1,g);'
	db           'n=.05*mix(vec3(.4,.9,.3)-vec3(.2*f(q.xz).x),.8*vec3(.6,.8,.2),t);'
	db           'Z=.5-.5*(1.-t);'
	db           'Y=10.*(1.-t);'
	db         '}'
	db       'else'
	db         ' if(q.y<1.)'
	db           'n=vec3(.01+.04*step(g,.07))+vec3(.7)*step(.145,g),Y=1.;'
	db       'e+=n*T(q,W,R(q,W,z))*r*X(W);'
	db       'vec3 t=vec3(-W.x,W.y,-W.z);'
	db       'e+=n*R(q,t,R(q,t,z),vec3(0.))*X(t);'
	db       'e+=n*vec3(.07)*X(normalize(vec3(1.)));'
	db       'e+=V;'
	db     '}'
	db   'else'
	db     ' d=R(C,b,z);'
	db   'e=R(C,b,d,e);'
	db   'gl_FragColor=vec4(pow(e,vec3(1./2.2)),.5);'
	db '}', 0

